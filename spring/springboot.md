---
layout: default
title: SpringBoot
nav_order: 1
parent: Spring
---

#### SpringBoot
{: .no_toc}

##### 无事务方法
springboot中无事务方法会自动提交，例如update、insert、delete，执行完即提交，想要控制需要添加事务，如@Transactional

##### 事务
在同一个类里面：
    没有事务的方法调用有事务的方法，则事务不生效
    一个有事务的方法连续调用两个数据库操作小方法，第一个有事务，第二个没事务（注：当两个数据库都加了事务管理，检测是否第二个异常，第一个是否会回滚（暂时未作测试））
    一个有事务的方法连续执行两个数据库操作，则第二个数据库操作异常时会进行事务回滚
注：一个方法里面有多个需要事务管理的小方法，可以将小方法单独放到另一个类中进行事务管理
##### 同时操作两个数据库（主库与归档库），进行数据迁移，涉及到事务问题
````
有页面：
目标库（有归档库则新增配置即可）下拉框
目标表  查询窗口
源库  下拉框
源表（根据目标表与源库获得）下拉框
索引（根据目标表获得）下拉框
索引值（有限制数量，多个使用逗号隔开）
步骤：
    a.根据索引值获得源表数据量，超过限制数量则不进行回迁
    b1.源表为归档库，则将查询数据返回为ResultSet （可以获得列、列值、列属性），进行sql拼接，以及值属性的匹配，注：Date类型使用Timestamp，类型匹配java.sql.Type
    b2.源表为主库，直接insert into....select * from .....where 索引=索引值;
    c.删除源表数据，主库在insert后直接删除 ，归档库则：   
        1.非springboot项目，可以在将插入目标表与删除源表数据分成两个方法，删除源表数据进行手动提交与rollback
        2.springboot项目，将插入目标表与删除源表数据在一个方法中写，源库datasource使用注解@Qualifier("**")注明哪个数据库
````